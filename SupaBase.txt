-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.assignment_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_assignment_id uuid NOT NULL,
  action character varying NOT NULL,
  from_operator_id uuid,
  to_operator_id uuid,
  performed_by uuid NOT NULL,
  reason text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT assignment_history_pkey PRIMARY KEY (id),
  CONSTRAINT assignment_history_to_operator_id_fkey FOREIGN KEY (to_operator_id) REFERENCES public.warehouse_operators(id),
  CONSTRAINT assignment_history_order_assignment_id_fkey FOREIGN KEY (order_assignment_id) REFERENCES public.order_assignments(id),
  CONSTRAINT assignment_history_from_operator_id_fkey FOREIGN KEY (from_operator_id) REFERENCES public.warehouse_operators(id),
  CONSTRAINT assignment_history_performed_by_fkey FOREIGN KEY (performed_by) REFERENCES auth.users(id)
);
CREATE TABLE public.customers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  email character varying NOT NULL UNIQUE,
  phone character varying,
  address text,
  city character varying,
  state character varying,
  zip_code character varying,
  country character varying DEFAULT 'USA'::character varying,
  outstanding_balance numeric DEFAULT 0,
  credit_limit numeric DEFAULT 10000,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  created_by uuid,
  CONSTRAINT customers_pkey PRIMARY KEY (id),
  CONSTRAINT customers_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.order_assignments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid NOT NULL,
  suggested_operator_id uuid,
  assigned_operator_id uuid,
  suggested_by character varying DEFAULT 'AI'::character varying,
  suggestion_reason text,
  suggestion_confidence numeric,
  status character varying NOT NULL DEFAULT 'pending'::character varying,
  manager_id uuid,
  manager_notes text,
  assignment_accepted_at timestamp with time zone,
  work_started_at timestamp with time zone,
  work_completed_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT order_assignments_pkey PRIMARY KEY (id),
  CONSTRAINT order_assignments_manager_id_fkey FOREIGN KEY (manager_id) REFERENCES auth.users(id),
  CONSTRAINT order_assignments_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id),
  CONSTRAINT order_assignments_suggested_operator_id_fkey FOREIGN KEY (suggested_operator_id) REFERENCES public.warehouse_operators(id),
  CONSTRAINT order_assignments_assigned_operator_id_fkey FOREIGN KEY (assigned_operator_id) REFERENCES public.warehouse_operators(id)
);
CREATE TABLE public.order_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid,
  product_id uuid,
  product_name character varying NOT NULL,
  product_sku character varying,
  quantity integer NOT NULL,
  unit character varying NOT NULL,
  unit_price numeric NOT NULL,
  total_price numeric NOT NULL,
  original_text text,
  confidence_level character varying,
  match_status character varying,
  stock_available integer,
  stock_status character varying,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT order_items_pkey PRIMARY KEY (id),
  CONSTRAINT order_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT order_items_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id)
);
CREATE TABLE public.orders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_number character varying NOT NULL UNIQUE,
  customer_id uuid,
  sales_agent_id uuid,
  natural_language_order text,
  delivery_date date NOT NULL,
  delivery_time time without time zone,
  payment_type character varying NOT NULL,
  status character varying DEFAULT 'draft'::character varying,
  subtotal numeric DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  discount_amount numeric DEFAULT 0,
  total_amount numeric DEFAULT 0,
  invoice_number character varying,
  invoice_sent boolean DEFAULT false,
  invoice_sent_at timestamp with time zone,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  warehouse_status character varying DEFAULT 'pending_assignment'::character varying,
  priority_level integer DEFAULT 5,
  estimated_preparation_time interval,
  actual_preparation_time interval,
  special_handling_notes text,
  CONSTRAINT orders_pkey PRIMARY KEY (id),
  CONSTRAINT orders_sales_agent_id_fkey FOREIGN KEY (sales_agent_id) REFERENCES auth.users(id),
  CONSTRAINT orders_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id)
);
CREATE TABLE public.products (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id character varying NOT NULL UNIQUE,
  product_name character varying NOT NULL,
  sku character varying,
  quantity integer NOT NULL DEFAULT 0,
  unit character varying NOT NULL,
  price numeric NOT NULL,
  cost numeric,
  min_stock_level integer DEFAULT 10,
  max_stock_level integer DEFAULT 100,
  category character varying,
  description text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  created_by uuid,
  updated_by uuid,
  barcode character varying UNIQUE,
  search_vector tsvector,
  search_text text,
  CONSTRAINT products_pkey PRIMARY KEY (id),
  CONSTRAINT products_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES auth.users(id),
  CONSTRAINT products_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  email text UNIQUE,
  role USER-DEFINED NOT NULL DEFAULT 'sales_agent'::user_role,
  created_at timestamp without time zone DEFAULT now(),
  full_name character varying,
  CONSTRAINT profiles_pkey PRIMARY KEY (id)
);
CREATE TABLE public.warehouse_operators (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL UNIQUE,
  operator_name character varying NOT NULL,
  is_available boolean DEFAULT true,
  current_workload integer DEFAULT 0,
  specializations ARRAY,
  shift_start time without time zone,
  shift_end time without time zone,
  performance_score numeric DEFAULT 5.0,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT warehouse_operators_pkey PRIMARY KEY (id),
  CONSTRAINT warehouse_operators_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);